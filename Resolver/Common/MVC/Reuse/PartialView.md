=========================================================================
# Partial view:
* -> a **Razor markup (.cshtml) file** that **`render HTML output within another markup file`** (_views are rendered within another view_)
* -> it's not a complete view, but instead used for **the `reusability` of the HTML markup** (other **`views`** or **`layout`**)
* -> include **break up large markup** files into smaller components; **reduce the duplication** of common markup content across markup file; **`shouldn't be used to maintain common layout elements`**

* _hiểu đơn giản thì `HTML output generated by partial view` được render vào view cha_
* _nó giống **user control** in **`ASP.NET Web Form`** used for code re-usability_
* _ta có thể dùng nó cho `Header` view, `Footer` view, or `display blog comments, product categories, social bookmark buttons, a dynamic ticker, a calendar, ...`_

## Note
* -> can consist of both **HTML markup, Razor Code and CSS, Javascrip**
* -> can also be **returned directly from controller methods** - in this case, the browser still receives text/HTML content but **`not necessarily HTML content that makes up an entire page`**
* -> it's best practice to create partial view in **~/Views/Shared**, and name the partial view file with preceded by **_**

=========================================================================
# Partial View Usage
* -> a partial view is rendered by using the **ViewUserControl** class that is inherited/derived from the **`ASP.NET UserControl class`**

* -> _there are different ways of rendering partial view in MVC Razor:_
* -> **`Static Partial View`** - view renders the static data: **Html.RenderPartial**, **Html.Partial**_
* -> **`Dynamic Partial View`** - view implements the dynamic data: **Html.Action**, **Html.RenderAction**

## Html.Partial
* -> this helper method **renders a partial view into a string**
* -> accept **`view name`** as parameter and returns **MVCHtmlString** object - a **`specialized HTML-encoded string`** that can be directly rendered in the view
* -> so we **can assigned to a variable** and **manipulate if required** (_really rare_) before rendering

```cs
// Razor syntax
@Html.Partial("ViewName") // directly rendered in the view in this position (where they get called)
@Html.Partial("ViewName", Model) // pass a model to the Partial view 

// WebView syntax
<% Html.RenderPartial("ViewName"); %>
```

```cs
@{ string htmlData = @Html.Partial("ViewName").ToString(); }
```

## Html.RenderPartial 
* -> is a method of the **HtmlHelper** class that **`returns void`** 
* -> **HTML output of partial view will be written `directly` to the `HTTP response stream`**
* => so it **better performance** compare to **`Html.Partial`** because the view content is not **buffered in memory**

```cs
@{ Html.RenderPartial("ViewName"); } // directly rendered in the view in this position (where they get called)
@{ Html.RenderPartial("ViewName", Model) } // pass a model to the Partial view 
```

## Html.Action
* -> **invokes the specified child `action method`** and returns the result as an HTML string
* _về cơ bản thì có 3 thành phần tương tác, `Html.Action` call an `action method` return a `partial view`_

```cs
// Index.cshtml
@Html.Action("Show", "About", new { param = "value"} )

// AboutController.cs
[ChildActionOnly] // cannot call using URL
public ActionResult Show(string param)
{
    var data = _db.Users.Find(param);
    return PartialView("_RenderActionMenu",data);
}

// Views/Shared/_RenderActionMenu.cshtml
@model List<MVC5_HelloWorld.Models.User>
<td>@Model.Username</td>
<td>@Model.Password</td>
```

```cs
@{string result = @Html.Action("Action", "Controller", new { param = "value"} ).ToString();}
```

## Html.RenderAction
* -> is a method of the **Controller** class **invokes** a specified **`child action method`** and **`renders the result inline in the parent view`**
* -> the _Action Method_ must be marked with the **[ChildActionOnly]** attribute and return the **`PartialViewResult`** using the **PartialView()** method
* -> this method is the best choice when we want to **cache a partial view**
* -> _it is faster than the Action method since its result is directly written to the HTTP response stream_

```cs
@{Html.RenderAction("Action", "Controller", new { param = "value"} ).ToString();}
```

=========================================================================
# RenderAction vs RenderPartial

## RenderPartial
* -> the _renderPartial_ method is useful when the **`displaying data in the partial view`** is **already in the corresponding view model**
* _tức là `parent view` sẽ cần được pass model mà `partial view` cần; hoặc nói cách khác thì `model` for `parent view` có đầy đủ thông tin cần thiết_

* -> usually used when output **could be considered part of the calling view** but separating it out into another view
* _tức là những `partial view` được render bới `RenderPartial` thường trực tiếp là 1 phần của `calling view` (cả về mặt UI lẫn data) nhưng được tách riêng ra để tái sử dụng_

* _Ex: In a blog to show comments on an article, we would like to use the RenderPartial method since article information with comments is already populated in the view model_

## RenderAction
* -> the partial view rendered using **`RenderAction`** on the other hand could **`contain a completely different model with no need for this to be passed in to our parent view`**
* -> usually used when the thing that needs to be rendered **isn’t the responsibility of the calling view or controller**
* _tức là ví dụ ta muốn render 1 view `Person`, nhưng trong đó có 1 list `Project` thì ta nên sử dụng `ProjectController` thay vì `PersonController` vì the concern of `display Project` belong to `ProjectController`_

* _Ex: In a blog to show a category list on each and every page, we would like to use RenderAction method since the list of category is populated by the different model_

=========================================================================
# RenderPage vs Html.RenderPartial

## Html.RenderPartial
* -> Html.RenderPartial follow **standard rules for view lookup** (_Ex: check current directory, then check the "Shared" directory_), so we only to provide it the **`view name`** to lookup
```cs
Html.RenderPartial("MyView")
```

## RenderPage
* -> renders the **specified `view` identified by `path` and `file name`** (_rather than by view name_) 
* -> also writes its output **directly to the response stream** (_like Html.RenderPartial()_)

```cs
RenderPage("MyView.cshtml") // need to explicit the file name
```

=========================================================================
# Render Partial View Using jQuery
* -> sometimes we need to **`load a partial view`** (_Ex: a login box within a popup_) on **run time** 
* -> then we can **use `jQuery` to make an AJAX request** and render a Partial View into view

```js - to load a partial view within a div
<script type="text/jscript"> 
    $('#divpopup').load('/shared/_ProductCategory'); 
</script> 
```

=========================================================================
# Implement: cut the Menu / nagigation bar in _Layout.cshtml into a partial view

## Create a partial view
* -> create a file name `_MenuBar.cshtml` inside **Shared** folder (_we can create `partial view` in any `view` folder; however it recommended to create all partial views in the `Shared` folder so that they can be used in multiple views_)
* -> cut the markup of Menu in `_Layout.cshtml` to `_Menu.cshtml`

```js - _MenuBar.cshtml
<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            @Html.ActionLink("Application name", "Index", "Home", new { area = "" }, new { @class = "navbar-brand" })
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li>@Html.ActionLink("Home", "Index", "Home")</li>
                <li>@Html.ActionLink("About", "About", "Home")</li>
                <li>@Html.ActionLink("Contact", "Contact", "Home")</li>
            </ul>
        </div>
    </div>
</div>
```

## Render partial view

```js - _Layout.cshtml
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - My ASP.NET Application</title>
    @Styles.Render("~/Content/css") 
    @Scripts.Render("~/bundles/modernizr")
</head>
<body>
    
    @Html.Partial("_MenuBar") {/** this one **/}

    @{
      Html.RenderPartial("_MenuBar"); {/** this one **/}
    }

    @{
        Html.RenderAction("RenderMenu", "Home"); {/** this one **/}
    }
    
    @* you can modify result as below   *@
    @* var result = Html.Partial("_MenuBar") *@
    <div class="container body-content">
        @RenderBody()
        <hr />
        <footer>
            <p>&copy; @DateTime.Now.Year - My ASP.NET Application</p>
        </footer>
    </div>
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @RenderSection("scripts", required: false)
</body>
</html>
```

```cs - for the "html.RenderAction()"
public class HomeController : Controller
{
    [ChildActionOnly]
    public ActionResult RenderMenu()
    {
        return PartialView("_MenuBar");
    }
}
```